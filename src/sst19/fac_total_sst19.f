!
!Â© 2003 The Johns Hopkins University Applied Physics Laboratory LLC
!
c %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
      SUBROUTINE fac_total_sst19 (xKappa1,xKappa2,
     .     tilt,X,Y,Z,
     .     BX11am,BY11am,BZ11am,
     .     BX12am,BY12am,BZ12am,
     .     BX11sm,BY11sm,BZ11sm,
     .     BX12sm,BY12sm,BZ12sm,
     .     BX11a,BY11a,BZ11a,
     .     BX12a,BY12a,BZ12a,
     .     BX11s,BY11s,BZ11s,
     .     BX12s,BY12s,BZ12s,
     .     BX21am,BY21am,BZ21am,
     .     BX22am,BY22am,BZ22am,      
     .     BX21sm,BY21sm,BZ21sm,
     .     BX22sm,BY22sm,BZ22sm,
     .     BX21a,BY21a,BZ21a,
     .     BX22a,BY22a,BZ22a,      
     .     BX21s,BY21s,BZ21s,
     .     BX22s,BY22s,BZ22s)
C
      IMPLICIT NONE

C     Inputs
      REAL*8  xKappa1,xKappa2
      REAL*8  tilt
      REAL*8  X,Y,Z
      
C     Outputs
      REAL*8  BX11am,BY11am,BZ11am
      REAL*8  BX12am,BY12am,BZ12am
      REAL*8  BX11sm,BY11sm,BZ11sm
      REAL*8  BX12sm,BY12sm,BZ12sm
      REAL*8  BX11a,BY11a,BZ11a
      REAL*8  BX12a,BY12a,BZ12a
      REAL*8  BX11s,BY11s,BZ11s
      REAL*8  BX12s,BY12s,BZ12s
      REAL*8  BX21am,BY21am,BZ21am
      REAL*8  BX22am,BY22am,BZ22am
      REAL*8  BX21sm,BY21sm,BZ21sm
      REAL*8  BX22sm,BY22sm,BZ22sm
      REAL*8  BX21a,BY21a,BZ21a
      REAL*8  BX22a,BY22a,BZ22a
      REAL*8  BX21s,BY21s,BZ21s
      REAL*8  BX22s,BY22s,BZ22s
      
c     Internal variables
      REAL*8  SH11a(86),SH12a(86),SH21a(86),SH22a(86)
      REAL*8  SH11s(86),SH12s(86),SH21s(86),SH22s(86)
      REAL*8  A11(30),A12(30),A21(30),A22(30)
      REAL*8  theta0_11,theta0_12,theta0_21,theta0_22
      REAL*8  theta0_11m,theta0_12m,theta0_21m,theta0_22m
      REAL*8  dPhi1,dPhi2
      REAL*8  dTheta1,dTheta2
      REAL*8  XS,YS,ZS
      REAL*8  FX11,FY11,FZ11, HX11,HY11,HZ11
      REAL*8  FX12,FY12,FZ12, HX12,HY12,HZ12
      REAL*8  FX21,FY21,FZ21, HX21,HY21,HZ21
      REAL*8  FX22,FY22,FZ22, HX22,HY22,HZ22
      REAL*8  x_sc1,x_sc2
      LOGICAL smooth
      
      DATA A11/.1618068350,-.1797957553,2.999642482,-.9322708978,
     *-.6811059760,.2099057262,-8.358815746,-14.86033550,.3838362986,
     *-16.30945494,4.537022847,2.685836007,27.97833029,6.330871059,
     *1.876532361,18.95619213,.9651528100,.4217195118,-.08957770020,
     *-1.823555887,.7457045438,-.5785916524,-1.010200918,.01112389357,
     *.09572927448,-.3599292276,8.713700514,.9763932955,3.834602998,
     *2.492118385/
      DATA A12/.7058026940,-.2845938535,5.715471266,-2.472820880,
     *-.7738802408,.3478293930,-11.37653694,-38.64768867,.6932927651,
     *-212.4017288,4.944204937,3.071270411,33.05882281,7.387533799,
     *2.366769108,79.22572682,.6154290178,.5592050551,-.1796585105,
     *-1.654932210,.7309108776,-.4926292779,-1.130266095,-.009613974555,
     *.1484586169,-.2215347198,7.883592948,.02768251655,2.950280953,
     *1.212634762/
      DATA A21/.1278764024,-.2320034273,1.805623266,-32.37241440,
     *-.9931490648,.3175085630,-2.492465814,-16.21600096,.2695393416,
     *-6.752691265,3.971794901,14.54477563,41.10158386,7.912889730,
     *1.258297372,9.583547721,1.014141963,.5104134759,-.1790430468,
     *-1.756358428,.7561986717,-.6775248254,-.04014016420,.01446794851,
     *.1200521731,-.2203584559,4.508963850,.8221623576,1.779933730,
     *1.102649543/
      DATA A22/.4036015198,-.3302974212,2.827730930,-45.44405830,
     *-1.611103927,.4927112073,-.003258457559,-49.59014949,.3796217108,
     *-233.7884098,4.312666980,18.05051709,28.95320323,11.09948019,
     *.7471649558,67.10246193,.5667096597,.6468519751,-.1560665317,
     *-1.460805289,.7719653528,-.6658988668,.2515179349E-05,
     *.02426021891,.1195003324,-.2625739255,4.377172556,.2421190547,
     *2.503482679,1.071587299/
      
      DATA SH11a/46488.84663,-15541.95244,-23210.09824,-32625.03856,
     *-109894.4551,-71415.32808,58168.94612,55564.87578,-22890.60626,
     *-6056.763968,5091.368100,239.7001538,-13899.49253,4648.016991,
     *6971.310672,9699.351891,32633.34599,21028.48811,-17395.96190,
     *-16461.11037,7447.621471,2528.844345,-1934.094784,-588.3108359,
     *-32588.88216,10894.11453,16238.25044,22925.60557,77251.11274,
     *50375.97787,-40763.78048,-39088.60660,15546.53559,3559.617561,
     *-3187.730438,309.1487975,88.22153914,-243.0721938,-63.63543051,
     *191.1109142,69.94451996,-187.9539415,-49.89923833,104.0902848,
     *-120.2459738,253.5572433,89.25456949,-205.6516252,-44.93654156,
     *124.7026309,32.53005523,-98.85321751,-36.51904756,98.88241690,
     *24.88493459,-55.04058524,61.14493565,-128.4224895,-45.35023460,
     *105.0548704,-43.66748755,119.3284161,31.38442798,-92.87946767,
     *-33.52716686,89.98992001,25.87341323,-48.86305045,59.69362881,
     *-126.5353789,-44.39474251,101.5196856,59.41537992,41.18892281,
     *80.86101200,3.066809418,7.893523804,30.56212082,10.36861082,
     *8.222335945,19.97575641,2.050148531,4.992657093,2.300564232,
     *.2256245602,-.05841594319/
      DATA SH12a/210260.4816,-1443587.401,-1468919.281,281939.2993,
     *-1131124.839,729331.7943,2573541.307,304616.7457,468887.5847,
     *181554.7517,-1300722.650,-257012.8601,645888.8041,-2048126.412,
     *-2529093.041,571093.7972,-2115508.353,1122035.951,4489168.802,
     *75234.22743,823905.6909,147926.6121,-2276322.876,-155528.5992,
     *-858076.2979,3474422.388,3986279.931,-834613.9747,3250625.781,
     *-1818680.377,-7040468.986,-414359.6073,-1295117.666,-346320.6487,
     *3565527.409,430091.9496,-.1565573462,7.377619826,.4115646037,
     *-6.146078880,3.808028815,-.5232034932,1.454841807,-12.32274869,
     *-4.466974237,-2.941184626,-.6172620658,12.64613490,1.494922012,
     *-21.35489898,-1.652256960,16.81799898,-1.404079922,-24.09369677,
     *-10.99900839,45.94237820,2.248579894,31.91234041,7.575026816,
     *-45.80833339,-1.507664976,14.60016998,1.348516288,-11.05980247,
     *-5.402866968,31.69094514,12.28261196,-37.55354174,4.155626879,
     *-33.70159657,-8.437907434,36.22672602,145.0262164,70.73187036,
     *85.51110098,21.47490989,24.34554406,31.34405345,4.655207476,
     *5.747889264,7.802304187,1.844169801,4.867254550,2.941393119,
     *.1379899178,.06607020029/
      DATA SH21a/162294.6224,503885.1125,-27057.67122,-531450.1339,
     *84747.05678,-237142.1712,84133.61490,259530.0402,69196.05160,
     *-189093.5264,-19278.55134,195724.5034,-263082.6367,-818899.6923,
     *43061.10073,863506.6932,-139707.9428,389984.8850,-135167.5555,
     *-426286.9206,-109504.0387,295258.3531,30415.07087,-305502.9405,
     *100785.3400,315010.9567,-15999.50673,-332052.2548,54964.34639,
     *-152808.3750,51024.67566,166720.0603,40389.67945,-106257.7272,
     *-11126.14442,109876.2047,2.978695024,558.6019011,2.685592939,
     *-338.0004730,-81.99724090,-444.1102659,89.44617716,212.0849592,
     *-32.58562625,-982.7336105,-35.10860935,567.8931751,-1.917212423,
     *-260.2023543,-1.023821735,157.5533477,23.00200055,232.0603673,
     *-36.79100036,-111.9110936,18.05429984,447.0481000,15.10187415,
     *-258.7297813,-1.032340149,-298.6402478,-1.676201415,180.5856487,
     *64.52313024,209.0160857,-53.85574010,-98.52164290,14.35891214,
     *536.7666279,20.09318806,-309.7349530,58.54144539,67.45226850,
     *97.92374406,4.752449760,10.46824379,32.91856110,12.05124381,
     *9.962933904,15.91258637,1.804233877,6.578149088,2.515223491,
     *.1930034238,-.02261109942/
      DATA SH22a/-131287.8986,-631927.6885,-318797.4173,616785.8782,
     *-50027.36189,863099.9833,47680.20240,-1053367.944,-501120.3811,
     *-174400.9476,222328.6873,333551.7374,-389338.7841,-1995527.467,
     *-982971.3024,1960434.268,297239.7137,2676525.168,-147113.4775,
     *-3358059.979,-2106979.191,-462827.1322,1017607.960,1039018.475,
     *520266.9296,2627427.473,1301981.763,-2577171.706,-238071.9956,
     *-3539781.111,94628.16420,4411304.724,2598205.733,637504.9351,
     *-1234794.298,-1372562.403,-2.646186796,-31.10055575,2.295799273,
     *19.20203279,30.01931202,-302.1028550,-14.78310655,162.1561899,
     *.4943938056,176.8089129,-.2444921680,-100.6148929,9.172262228,
     *137.4303440,-8.451613443,-84.20684224,-167.3354083,1321.830393,
     *76.89928813,-705.7586223,18.28186732,-770.1665162,-9.084224422,
     *436.3368157,-6.374255638,-107.2730177,6.080451222,65.53843753,
     *143.2872994,-1028.009017,-64.22739330,547.8536586,-20.58928632,
     *597.3893669,10.17964133,-337.7800252,159.3532209,76.34445954,
     *84.74398828,12.76722651,27.63870691,32.69873634,5.145153451,
     *6.310949163,6.996159733,1.971629939,4.436299219,2.904964304,
     *.1486276863,.06859991529/

      DATA SH11s/ 4956703.683,-26922641.21,-11383659.85,29604361.65,
     *-38919785.97,70230899.72,34993479.24,-90409215.02,30448713.69,
     *-48360257.19,-35556751.23,57136283.60,-8013815.613,30784907.86,
     * 13501620.50,-35121638.52,50297295.45,-84200377.18,-46946852.58,
     * 107526898.8,-39003263.47,59465850.17,47264335.10,-68892388.73,
     * 3375901.533,-9181255.754,-4494667.217,10812618.51,-17351920.97,
     * 27016083.00,18150032.11,-33186882.96,13340198.63,-19779685.30,
     * -17891788.15,21625767.23,16135.32442,133094.0241,-13845.61859,
     *-79159.98442,432.1215298,-85438.10368,1735.386707,41891.71284,
     * 18158.14923,-105465.8135,-11685.73823,62297.34252,-10811.08476,
     * -87631.38186,9217.499261,52079.94529,-68.29127454,56023.02269,
     * -1246.029857,-27436.42793,-11972.61726,69607.08725,7702.743803,
     * -41114.36810,12.08269108,-21.30967022,-9.100782462,18.26855933,
     * -7.000685929,26.22390883,6.392164144,-21.99351743,2.294204157,
     * -16.10023369,-1.344314750,9.342121230,148.5493329,99.79912328,
     * 70.78093196,35.23177574,47.45346891,58.44877918,139.8135237,
     * 91.96485261,6.983488815,9.055554871,19.80484284,2.860045019,
     * .8213262337E-01,-.7962186676E-05/
      DATA SH12s/-1210748.720,-52324903.95,-14158413.33,19426123.60,
     * 6808641.947,-5138390.983,-1118600.499,-4675055.459,2059671.506,
     * -1373488.052,-114704.4353,-1435920.472,1438451.655,61199067.17,
     *  16549301.39,-22802423.47,-7814550.995,5986478.728,1299443.190,
     *  5352371.724,-2994351.520,1898553.337,203158.3658,2270182.134,
     * -618083.3112,-25950806.16,-7013783.326,9698792.575,3253693.134,
     * -2528478.464,-546323.4095,-2217735.237,1495336.589,-914647.4222,
     * -114374.1054,-1200441.634,-507068.4700,1163189.975,998411.8381,
     * -861919.3631,5252210.872,-11668550.16,-4113899.385,6972900.950,
     * -2546104.076,7704014.310,2273077.192,-5134603.198,256205.7901,
     * -589970.8086,-503821.0170,437612.8956,-2648640.128,5887640.735,
     *  2074286.234,-3519291.144,1283847.104,-3885817.147,-1145936.942,
     *  2589753.651,-408.7788403,1234.054185,739.8541716,-965.8068853,
     *  3691.383679,-8628.635819,-2855.844091,5268.500178,-1774.372703,
     *  5515.010707,1556.089289,-3665.434660,204.8672197,110.7748799,
     *  87.36036207,5.522491330,31.06364270,73.57632579,281.5331360,
     *  140.3461448,17.07537768,6.729732641,4.100970449,2.780422877,
     *  .8742978101E-01,-.1028562327E-04/
      DATA SH21s/-67763516.61,-49565522.84,10123356.08,51805446.10,
     * -51607711.68,164360662.1,-4662006.024,-191297217.6,-7204547.103,
     * 30372354.93,-750371.9365,-36564457.17,61114395.65,45702536.50,
     * -9228894.939,-47893708.68,47290934.33,-149155112.0,4226520.638,
     * 173588334.5,7998505.443,-33150962.72,832493.2094,39892545.84,
     * -11303915.16,-8901327.398,1751557.110,9382865.820,-9054707.868,
     * 27918664.50,-788741.7146,-32481294.42,-2264443.753,9022346.503,
     * -233526.0185,-10856269.53,-244450.8850,1908295.272,185445.1967,
     * -1074202.863,41827.75224,-241553.7626,-20199.12580,123235.6084,
     * 199501.4614,-1936498.464,-178857.4074,1044724.507,121044.9917,
     * -946479.9247,-91808.28803,532742.7569,-20742.28628,120633.2193,
     * 10018.49534,-61599.11035,-98709.58977,959095.1770,88500.43489,
     * -517471.5287,-81.56122911,816.2472344,55.30711710,-454.5368824,
     * 25.74693810,-202.5007350,-7.369350794,104.9429812,58.14049362,
     * -685.5919355,-51.71345683,374.0125033,247.9296982,159.2471769,
     * 102.3151816,15.81062488,34.99767599,133.0832773,219.6475201,
     * 107.9582783,10.00264684,7.718306072,25.22866153,5.013583103,
     * .8407754233E-01,-.9613356793E-05/
      DATA SH22s/-43404887.31,8896854.538,-8077731.036,-10247813.65,
     * 6346729.086,-9416801.212,-1921670.268,7805483.928,2299301.127,
     * 4856980.170,-1253936.462,-4695042.690,54305735.91,-11158768.10,
     * 10051771.85,12837129.47,-6380785.836,12387093.50,1687850.192,
     * -10492039.47,-5777044.862,-6916507.424,2855974.911,7027302.490,
     * -26176628.93,5387959.610,-4827069.106,-6193036.589,2511954.143,
     * -6205105.083,-553187.2984,5341386.847,3823736.361,3669209.068,
     * -1841641.700,-3842906.796,281561.7220,-5013124.630,379824.5943,
     * 2436137.901,-76337.55394,548518.2676,42134.28632,-281711.3841,
     * -365514.8666,-2583093.138,-232355.8377,1104026.712,-131536.3445,
     *  2320169.882,-174967.6603,-1127251.881,35539.82827,-256132.9284,
     * -19620.06116,131598.7965,169033.6708,1194443.500,107320.3699,
     * -510672.0036,1211.177843,-17278.19863,1140.037733,8347.612951,
     * -303.8408243,2405.771304,174.0634046,-1248.722950,-1231.229565,
     * -8666.932647,-754.0488385,3736.878824,227.2102611,115.9154291,
     * 94.34364830,3.625357304,64.03192907,109.0743468,241.4844439,
     * 107.7583478,22.36222385,6.282634037,27.79399216,2.270602235,
     * .8708605901E-01,-.1256706895E-04/

      theta0_11=.7113544659
      theta0_12=.5567714182
      theta0_21=.8867880020
      theta0_22=.7247997430
      
      dPhi1=0.055d0
      dPhi2=0.030d0

      dTheta1=0.06d0
      dTheta2=0.09d0
      
      x_sc1=xKappa1-1.1d0    !  FORWARDED IN BIRK_SHL
      x_sc2=xKappa2-1.0d0    !  FORWARDED IN BIRK_SHL

c     the SST19 model smooths the FACs
      smooth=.true.

c     Modify Region 1 by shifting them equatorward and
c     modify the Region 2 by shifting them poleward
      theta0_11m=theta0_11+dTheta1
      theta0_12m=theta0_12+dTheta1

      theta0_21m=theta0_21-dTheta2
      theta0_22m=theta0_22-dTheta2
      
c     Region 1, Mode 1, Antisymmetric, Modified
      CALL fac_field (A11,theta0_11m,dTheta1,1,.false.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX11,FY11,FZ11)
      CALL fac_shield (SH11a,x_sc1,.true.,tilt,X,Y,Z,HX11,HY11,HZ11)
      BX11am=FX11+HX11
      BY11am=FY11+HY11
      BZ11am=FZ11+HZ11

c     Region 1, Mode 2, Antisymmetric, Modified
      CALL fac_field (A12,theta0_12m,dTheta1,2,.false.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX12,FY12,FZ12)
      CALL fac_shield (SH12a,x_sc1,.true.,tilt,X,Y,Z,HX12,HY12,HZ12)
      BX12am=FX12+HX12
      BY12am=FY12+HY12
      BZ12am=FZ12+HZ12

c     Region 2, Mode 1, Antisymmetric, Modified
      CALL fac_field (A21,theta0_21m,dTheta2,1,.false.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX21,FY21,FZ21)
      CALL fac_shield (SH21a,x_sc2,.true.,tilt,X,Y,Z,HX21,HY21,HZ21)
      BX21am=FX21+HX21
      BY21am=FY21+HY21
      BZ21am=FZ21+HZ21
      
c     Region 2, Mode 2, Antisymmetric, Modified
      CALL fac_field (A22,theta0_22m,dTheta2,2,.false.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX22,FY22,FZ22)
      CALL fac_shield (SH22a,x_sc2,.true.,tilt,X,Y,Z,HX22,HY22,HZ22)
      BX22am=FX22+HX22
      BY22am=FY22+HY22
      BZ22am=FZ22+HZ22

      
c     Region 1, Mode 1, Antisymmetric
      CALL fac_field (A11,theta0_11,dTheta1,1,.false.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX11,FY11,FZ11)
      CALL fac_shield (SH11a,x_sc1,.true.,tilt,X,Y,Z,HX11,HY11,HZ11)
      BX11a=FX11+HX11
      BY11a=FY11+HY11
      BZ11a=FZ11+HZ11

c     Region 1, Mode 2, Antisymmetric
      CALL fac_field (A12,theta0_12,dTheta1,2,.false.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX12,FY12,FZ12)
      CALL fac_shield (SH12a,x_sc1,.true.,tilt,X,Y,Z,HX12,HY12,HZ12)
      BX12a=FX12+HX12
      BY12a=FY12+HY12
      BZ12a=FZ12+HZ12

c     Region 2, Mode 1, Antisymmetric
      CALL fac_field (A21,theta0_21,dTheta2,1,.false.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX21,FY21,FZ21)
      CALL fac_shield (SH21a,x_sc2,.true.,tilt,X,Y,Z,HX21,HY21,HZ21)
      BX21a=FX21+HX21
      BY21a=FY21+HY21
      BZ21a=FZ21+HZ21
      
c     Region 2, Mode 2, Antisymmetric
      CALL fac_field (A22,theta0_22,dTheta2,2,.false.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX22,FY22,FZ22)
      CALL fac_shield (SH22a,x_sc2,.true.,tilt,X,Y,Z,HX22,HY22,HZ22)
      BX22a=FX22+HX22
      BY22a=FY22+HY22
      BZ22a=FZ22+HZ22
      

C   THIS S/R IS ALMOST IDENTICAL TO BIRK_TOT, BUT IT IS FOR THE SYMMETRIC MODE, IN WHICH
C     J_parallel IS AN EVEN FUNCTION OF Ygsm.

c     Region 1, Mode 1, Symmetric, Modified      
      CALL fac_field (A11,theta0_11m,dTheta1,1,.true.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX11,FY11,FZ11)
      CALL fac_shield (SH11s,x_sc1,.false.,tilt,X,Y,Z,HX11,HY11,HZ11)
      BX11sm=-FX11-HX11
      BY11sm=-FY11-HY11
      BZ11sm=-FZ11-HZ11

c     Region 1, Mode 2, Symmetric, Modified
      CALL fac_field (A12,theta0_12m,dTheta1,2,.true.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX12,FY12,FZ12)
      CALL fac_shield (SH12s,x_sc1,.false.,tilt,X,Y,Z,HX12,HY12,HZ12)
      BX12sm=-FX12-HX12
      BY12sm=-FY12-HY12
      BZ12sm=-FZ12-HZ12

c     Region 2, Mode 1, Symmetric, Modified
      CALL fac_field (A21,theta0_21m,dTheta2,1,.true.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX21,FY21,FZ21)
      CALL fac_shield (SH21s,x_sc2,.false.,tilt,X,Y,Z,HX21,HY21,HZ21)
      BX21sm=-FX21-HX21
      BY21sm=-FY21-HY21
      BZ21sm=-FZ21-HZ21

c     Region 2, Mode 2, Symmetric, Modified  
      CALL fac_field (A22,theta0_22m,dTheta2,2,.true.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX22,FY22,FZ22)
      CALL fac_shield (SH22s,x_sc2,.false.,tilt,X,Y,Z,HX22,HY22,HZ22)
      BX22sm=-FX22-HX22
      BY22sm=-FY22-HY22
      BZ22sm=-FZ22-HZ22
      
      
c     Region 1, Mode 1, Symmetric      
      CALL fac_field (A11,theta0_11,dTheta1,1,.true.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX11,FY11,FZ11)
      CALL fac_shield (SH11s,x_sc1,.false.,tilt,X,Y,Z,HX11,HY11,HZ11)
      BX11s=-FX11-HX11
      BY11s=-FY11-HY11
      BZ11s=-FZ11-HZ11

c     Region 1, Mode 2, Symmetric
      CALL fac_field (A12,theta0_12,dTheta1,2,.true.,smooth,
     .     dPhi1,xKappa1, tilt,X,Y,Z, FX12,FY12,FZ12)
      CALL fac_shield (SH12s,x_sc1,.false.,tilt,X,Y,Z,HX12,HY12,HZ12)
      BX12s=-FX12-HX12
      BY12s=-FY12-HY12
      BZ12s=-FZ12-HZ12

c     Region 2, Mode 1, Symmetric
      CALL fac_field (A21,theta0_21,dTheta2,1,.true.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX21,FY21,FZ21)
      CALL fac_shield (SH21s,x_sc2,.false.,tilt,X,Y,Z,HX21,HY21,HZ21)
      BX21s=-FX21-HX21
      BY21s=-FY21-HY21
      BZ21s=-FZ21-HZ21

c     Region 2, Mode 2, Symmetric  
      CALL fac_field (A22,theta0_22,dTheta2,2,.true.,smooth,
     .     dPhi2,xKappa2, tilt,X,Y,Z, FX22,FY22,FZ22)
      CALL fac_shield (SH22s,x_sc2,.false.,tilt,X,Y,Z,HX22,HY22,HZ22)
      BX22s=-FX22-HX22
      BY22s=-FY22-HY22
      BZ22s=-FZ22-HZ22

c      print *,BX11am,BY11am,BZ11am
c      print *,BX12am,BY12am,BZ12am
c      print *,BX11sm,BY11sm,BZ11sm
c      print *,BX12sm,BY12sm,BZ12sm      
c      print *,BX11a,BY11a,BZ11a
c      print *,BX12a,BY12a,BZ12a
c      print *,BX11s,BY11s,BZ11s
c      print *,BX12s,BY12s,BZ12s
c      print *,BX21am,BY21am,BZ21am
c      print *,BX22am,BY22am,BZ22am      
c      print *,BX21sm,BY21sm,BZ21sm
c      print *,BX22sm,BY22sm,BZ22sm
c      print *,BX21a,BY21a,BZ21a
c      print *,BX22a,BY22a,BZ22a      
c      print *,BX21s,BY21s,BZ21s
c      print *,BX22s,BY22s,BZ22s
      
      RETURN
      END
